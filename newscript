#!/bin/bash
BASEDIR=$(dirname $0)
source $BASEDIR/inc_msg.sh
function print_usage() {
cat << EOF
Usage: $(basename $0) [OPTIONS] [list of filenames for new scripts]
Valid options are:
    -b 
        Initialize edrtools BASEDIR variable
    -l
        Include lock file mechanism functions
    -m
        Include message printing functions
    -u
        Include user input multiple choice function
    -p
        Adds print_usage function
EOF
}

if [ "x$1" == "x-h" ];then
    print_usage
    exit 0
fi

while [ $# -gt 0 ];do
    case "$1" in
        '-b')
            INC_BASEDIR="y"
            shift
            continue
            ;;
        '-l')
            INC_LOCK="y"
            shift
            continue
            ;;
        '-m')
            INC_MSG="y"
            shift
            continue
            ;;
        '-u')
            INC_USER_INPUT="y"
            shift
            continue
            ;;
        '-p')
            INC_PRINT_USAGE="y"
            shift
            continue
            ;;
    esac
    NEWSCRIPT=$1
    [ -z $NEWSCRIPT ] && exit
    if [ ! -f $NEWSCRIPT ];then
        echo '#!/bin/bash' > $NEWSCRIPT
        [ "x$INC_BASEDIR" == "xy" ] && echo "BASEDIR=\$(dirname \$0)" >> $NEWSCRIPT
        [ "x$INC_LOCK" == "xy" ] && echo "source \$BASEDIR/inc_lock.sh" >> $NEWSCRIPT
        [ "x$INC_MSG" == "xy" ] && echo "source \$BASEDIR/inc_msg.sh" >> $NEWSCRIPT
        [ "x$INC_USER_INPUT" == "xy" ] && echo "source \$BASEDIR/inc_user_input.sh" >> $NEWSCRIPT
        [ "x$INC_PRINT_USAGE" == "xy" ] && cat >> $NEWSCRIPT << "EOF"
function print_usage(){
    echo "Usage: $(basename $0)"
}
if [ "x$1" == "x-h" ];then
    print_usage
    exit 0
fi
EOF
        chmod +x $NEWSCRIPT
    fi
    ${EDITOR:-vi} $NEWSCRIPT 
    shift
done
